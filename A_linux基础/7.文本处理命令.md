情报侦察、数据梳理、日志分析

# 1. awk

`awk`在处理庞大文件时不会出现内存溢出或是处理缓慢的问题，通常用来格式化文本信息。 `awk`也是一个非常棒的数据处理工具！相较于`sed`常常作用于一整个行的处理, `awk`则比较倾向于一行当中分成数个`字段`来处理。

==基本格式==：`awk ‘{print($1)}’`

```
awk -F ":" '{print($1)}'
awk -F ":" '{print($1"+++"$3)}'
awk -F ":" '{print $(NF-1)}'
```

# 2. sed

`sed` 本身是一个管线命令，可以将数据进行替换、删除、新增、提取特定行等功能，主要用来自动编辑一个或多个文件、简化对文件的反复操作、编写转换程序等。sed按行来执行命令。

**定界符是任意符号**

```
sed 's/:/+/g'
s代表搜索，g代表的则是全文。不加g的话则是替换每行第一个出现的。所以这条命令代表的将文件中所有的:替换为+

sed 's/:/+/3g'
代表的则是从第三次匹配开始替换，依此类推。

sed -i 's/:/+/g' 1.txt
参数-i,直接修改文件，并非打印出来。
```

搜索位置使用`^`代表一行的开头，`$`代表一行的结尾。`sed`是以行为单位执行的。

```
sed '/^$/d' 2.txt			删除空白的行。
sed '/^s/'d 				删除文件中所有开头是s的行。
```

# 3. grep

grep 程序会在文本文件中查找一个指定的正则表达式,并把匹配行输出到标准输出。

命令格式： `grep [options] [pattern]　[filename]`

```
grep -v root passwd                              忽略匹配到的行

cat [passwd] |grep -E "root|sshd"                 包含多个可能性的行
cat [passwd] |grep -E '^r'                        以r开头的行
cat [passwd] |grep -E 'n$'                        以n结尾的行

grep “root” [/etc/passwd] [/etc/shadow]             查询多个文件

grep "passwd" /etc -rn                          -r 为递归 -n 显示关键字出现在第几行   在多级目录中对文本进行递归查找
```

# 4. find

`find` 命令用来在指定目录下查找文件。任何位于参数之前的字符串都将被视为欲查找的目录名。如果使用该命令时，不设置任何参数，则 find  命令将在当前目录下查找子目录与文件。并且将查找到的子目录和文件全部进行显示。

```
find / -size 1000k                #从根目录查找大小为1000K的文件
find   -name '1*'                 #在当前目录下查找文件名以1开始的文件
find / -name '1*'                 #从根目录查找文件名以1开始的文件
find / -user farmsec1             #从根目录查找属主为farmsec1的文件
find / -group farmsec             #从根目录查找属组为farmsec的文件

find /etc -type f/d               #按sock类型查找，f代表文件，d代表目录

find . -type f -mtime -7          #搜索7天内当前目录下修改过的文件（-7代表7天内，7代表前7天那一天，+7代表7天前）
find . -type f -mmin -10          #搜索10分钟内当前目录下修改过的文件

find . -type f -atime -1          #搜索当前目录下一天内被访问的文件（-1代表1天内，1代表前1天那一天，+1代表1天前）
find . -type f -amin -10          #搜索当前目录下10分钟内被访问的文件

find . -ctime -1 -type f          #搜索当前目录下一天内状态被改变（列如权限）的文件（-1代表1天内，1代表前1天那一天，+1代表1天前）
find . -cmin -10 -type f          #搜索当前目录下10分钟内状态被改变的文件

find . -perm 777                  #搜索处当前文件下符合777权限的文件
```

**mac**

<u>m</u>odify					修改	

<u>a</u>ccess					 访问

<u>c</u>hange					状态改变（eg：权限）

time（天）

min（分钟）

**exec**

`find 搜索路径 [选项] 搜索内容 -exec 命令2{}\;`

# 5. ag

`ag`类似`grep`和`find`，但是执行效率更高。

```
ag -g <File Name>            # 类似于 find . -name <File Name>

ag -i PATTERN                # 忽略大小写搜索含PATTERN文本
ag -w PATTERN                #全匹配搜索，只搜索与所搜内容完全匹配的文本。

ag -A [number] PATTERN       #搜索含PATTERN文本，并显示匹配内容之后的n行文本，例如：ag -A 5  abc会显示搜索到的包含abc的行以及它之后5行的文本信息。
ag -B [number] PATTERN       #搜索含PATTERN文本，并显示匹配内容之前的n行文本
ag -C [number] PATTERN       #搜索含PATTERN文本，并同时显示匹配内容以及它前后各n行文本的内容。

ag --ignore-dir <Dir Name>   #忽略某些文件目录进行搜索。
ag --java PATTERN            #在java文件中搜索含PATTERN的文本。
ag --xml PATTERN             #在XML文件中搜索含PATTERN的
```

# 6. stat

用于显示文件信息

用法：stat [file/directory]

# 7. split

`split`命令可以将一个大文件分割成很多个小文件，有时需要将文件分割成更小的片段，比如为提高可读性，生成日志等。

```
-b			按文件大小进行切割
-l			按行数来进行切割

-d			为使用数字为生成文件的后缀
-a			指定后缀的长度
```

# 8. sort

将文件进行排序，并将排序结果标准输出

```
sort            #默认的排序方式，从首字母开始
sort -n         #按照数字进行排序
```

# 9. uniq

`uniq`用于报告或忽略文件中的重复行，一般与sort命令结合使用。

==先排序，后去重。因为uniq命令只能消除相邻且相同的行。==

```
-c			重复次数
-d			那些行是重复的
```

日志分析：

统计IP地址的访问数量并按照数量进行排序： `cat access_log |awk '{print($1)}'|sort|uniq -c |sort -nr |more`

针对访问量最大的IP分析其访问内容： `cat access_log |grep 'IP地址'|head -n 100`

# 10. nl

用于显示文件内容行号。

# 11.  远程连接

## 11.1 ssh

```
-l 为指定用户 如 ssh -l root 192.168.0.149		以root用户远程登录，也可写成ssh root@192.168.0.149

-p 为指定端口号
```

执行`ssh`的默认情况下，会使用本地的用户名连接对方的用户名，例如本地的root连接对面服务器的root，如果两端用户名不一样，则需要使用`-l username`指定用户名。

再确认密码后，方能登录成功，而同时变化的文件为：`/root/.ssh/known_hosts` 在第一次登录时，openssh将会提示不知道这台登录的主机，只要输入`yes`，就会把这台主机的“识别信息”添加到known_hosts文件中. 第二次登陆后，则无须此步骤，但是如果出现错误，例如主机产生变化，则需要删除`/root/.ssh/known_hosts`内容。

## 11.2 远程连接smb

Smb服务为网络文件共享协议，它允许应用程序和终端用户从远端的文件服务器访问文件资源

## 11.3 rdesktop 命令

`rdesktop`命令用于在linux下链接windows远程桌面。

用法：`rdesktop 192.168.0.178`

# 12. URL相关

## 12.1 curl

`curl`命令是一个利用URL规则在命令行下工作的文件传输工具。它支持文件的上传和下载，所以是综合传输工具，但按传统，习惯称curl为下载工具。作为一款强力工具，curl支持包括HTTP、HTTPS、ftp等众多协议，还支持POST、cookies、认证、从指定偏移处下载部分文件、用户代理字符串、限速、文件大小、进度条等特征。

用法：`curl [选项] [url]`

**参数：**

```
-i			显示头部信息
-v			显示请求全过程解析
-O			下载
```

## 12.2 wget

从指定的URL下载文件。wget非常稳定，它在带宽很窄的情况下和不稳定网络中有很强的适应性，如果是由于网络的原因下载失败，wget会不断的尝试，直到整个文件下载完毕。如果是服务器打断下载过程，它会再次联到服务器上从停止的地方继续下载。这对从那些限定了链接时间的服务器上下载大文件非常有用。

`-O`重命名



